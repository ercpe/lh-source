#!/bin/bash

if [[ -e /etc/portage/make.conf ]]; then
	source /etc/portage/make.conf
elif [[ -e /etc/make.conf ]]; then
	source /etc/make.conf
else
	echo "Cannot find make.conf"
	exit 1
fi

if type -p nproc > /dev/null; then
	NUMPROC=$(nproc)
else
	NUMPROC=1
fi

for overlay in ${PORTDIR_OVERLAY}; do
	echo "Creating metadata-cache for ${overlay} ..."
	overlayname="$(head -1 ${overlay}/profiles/repo_name)"
	egencache --jobs=${NUMPROC} --repo=${overlayname} --update
	echo ""
done
